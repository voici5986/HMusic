# iOS æƒé™è¯´æ˜æ–‡æ¡£

## ğŸ“± iOS æƒé™æœºåˆ¶è¯´æ˜

### é‡è¦æç¤º
iOS çš„æƒé™ç”³è¯·æœºåˆ¶ä¸ Android å®Œå…¨ä¸åŒï¼š

1. **ç½‘ç»œæƒé™ï¼ˆå›½é™…åŒºï¼‰** - å›½é™…åŒºiOSé¦–æ¬¡ä½¿ç”¨ç½‘ç»œæ—¶ä¼šå¼¹å‡º"WiFiä¸èœ‚çªæ•°æ®"é€‰æ‹©å¯¹è¯æ¡†ï¼Œéœ€è¦ä¸»åŠ¨å‘èµ·ç½‘ç»œè¯·æ±‚è§¦å‘
2. **ç½‘ç»œæƒé™ï¼ˆä¸­å›½åŒºï¼‰** - ä¸­å›½åŒºiOSä¸éœ€è¦å•ç‹¬ç”³è¯·ç½‘ç»œæƒé™ï¼Œåº”ç”¨é»˜è®¤å°±å¯ä»¥è®¿é—®ç½‘ç»œ
3. **æœ¬åœ°ç½‘ç»œæƒé™ (iOS 14+)** - åªåœ¨é¦–æ¬¡å°è¯•è®¿é—®æœ¬åœ°ç½‘ç»œæ—¶æ‰ä¼šå¼¹å‡ºå¯¹è¯æ¡†
4. **é€šçŸ¥æƒé™** - éœ€è¦é€šè¿‡ä»£ç ä¸»åŠ¨ç”³è¯·

---

## âœ… å·²é…ç½®çš„æƒé™

### 1. ç½‘ç»œè®¿é—®æƒé™ï¼ˆå›½é™…åŒºiOSï¼‰
**å®ç°ä½ç½®**: `ios/Runner/AppDelegate.swift:64-111`

```swift
/// è§¦å‘iOSç½‘ç»œæƒé™è¯·æ±‚ï¼ˆå›½é™…åŒºiOSéœ€è¦ï¼‰
private func triggerNetworkPermission() {
  DispatchQueue.global(qos: .userInitiated).async { [weak self] in
    let semaphore = DispatchSemaphore(value: 0)

    // åˆ›å»ºä¸€ä¸ªç®€å•çš„ç½‘ç»œè¯·æ±‚æ¥è§¦å‘æƒé™å¼¹çª—
    guard let url = URL(string: "https://www.apple.com/library/test/success.html") else {
      semaphore.signal()
      return
    }

    let task = URLSession.shared.dataTask(with: URLRequest(url: url)) { _, _, error in
      // è¯·æ±‚å®Œæˆï¼Œæ— è®ºæˆåŠŸå¤±è´¥
      semaphore.signal()
    }

    task.resume()

    // ç­‰å¾…ç½‘ç»œè¯·æ±‚å®Œæˆï¼ˆæœ€å¤šç­‰å¾…10ç§’ï¼‰
    _ = semaphore.wait(timeout: .now() + 10.0)

    // é¢å¤–ç­‰å¾…500msï¼Œç¡®ä¿æƒé™å¼¹çª—å¤„ç†å®Œæ¯•
    Thread.sleep(forTimeInterval: 0.5)
  }
}
```

**è§¦å‘æ—¶æœº**: åº”ç”¨å¯åŠ¨æ—¶ï¼Œåœ¨Flutterå¼•æ“åˆå§‹åŒ–**ä¹‹å‰**è‡ªåŠ¨è§¦å‘ï¼ˆåœ¨`didFinishLaunchingWithOptions`æ–¹æ³•çš„æœ€å¼€å§‹ï¼‰ï¼Œå¹¶é˜»å¡ç­‰å¾…æƒé™å¤„ç†å®Œæˆï¼ˆæœ€å¤š12ç§’ï¼‰ï¼Œç¡®ä¿ç”¨æˆ·å¤„ç†å®Œç½‘ç»œæƒé™å¼¹çª—åå†ç»§ç»­åˆå§‹åŒ–Flutterï¼Œé¿å…ä¸æœ¬åœ°ç½‘ç»œæƒé™å¼¹çª—å†²çª

**å¼¹çª—å†…å®¹**ï¼ˆå›½é™…åŒºiOSï¼‰:
```
"HMusic"æƒ³è¦ä½¿ç”¨æ•°æ®

æ­¤Appå°†èƒ½å¤Ÿé€šè¿‡æ— çº¿å±€åŸŸç½‘å’Œèœ‚çªç½‘ç»œè®¿é—®æ•°æ®ã€‚

[ä¸å…è®¸] [å¥½]
```

**è¯´æ˜**:
- å›½é™…åŒºiOSé¦–æ¬¡å®‰è£…åº”ç”¨æ—¶ï¼Œé»˜è®¤ç¦æ­¢ç½‘ç»œè®¿é—®
- å¿…é¡»é€šè¿‡å‘èµ·ç½‘ç»œè¯·æ±‚æ¥è§¦å‘ç³»ç»Ÿæƒé™å¯¹è¯æ¡†
- ç”¨æˆ·éœ€è¦é€‰æ‹©å…è®¸ä½¿ç”¨WiFiã€èœ‚çªæ•°æ®æˆ–ä¸¤è€…
- ä¸­å›½åŒºiOSä¸éœ€è¦æ­¤æ­¥éª¤ï¼Œåº”ç”¨é»˜è®¤å¯ä»¥è®¿é—®ç½‘ç»œ
- âš ï¸ **å…³é”®ä¼˜åŒ–**ï¼šç­‰å¾…ç½‘ç»œæƒé™å¼¹çª—å®Œå…¨å…³é—­åï¼ˆé¢å¤–å»¶è¿Ÿ1ç§’ï¼‰ï¼Œå†åˆå§‹åŒ–Flutterï¼Œé¿å…ä¸æœ¬åœ°ç½‘ç»œæƒé™å¼¹çª—åŒæ—¶å‡ºç°

---

### 2. åå°éŸ³é¢‘æ’­æ”¾
**é…ç½®æ–‡ä»¶**: `ios/Runner/Info.plist`

```xml
<key>UIBackgroundModes</key>
<array>
    <string>audio</string>
</array>
```

**ä½œç”¨**: å…è®¸åº”ç”¨åœ¨åå°æ’­æ”¾éŸ³é¢‘

---

### 3. æœ¬åœ°ç½‘ç»œè®¿é—®æƒé™
**é…ç½®æ–‡ä»¶**: `ios/Runner/Info.plist`

```xml
<key>NSLocalNetworkUsageDescription</key>
<string>HMusic éœ€è¦è®¿é—®æœ¬åœ°ç½‘ç»œä»¥è¿æ¥åˆ°éŸ³ä¹æœåŠ¡å™¨</string>

<key>NSBonjourServices</key>
<array>
    <string>_services._dns-sd._udp</string>
</array>
```

**è§¦å‘æ—¶æœº**:
- âš ï¸ **ä¸ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶å¼¹å‡º**
- âœ… åœ¨é¦–æ¬¡å°è¯•è®¿é—®æœ¬åœ° IP åœ°å€ï¼ˆå¦‚ `192.168.x.x`ï¼‰æ—¶è‡ªåŠ¨å¼¹å‡º
- ä¾‹å¦‚ï¼šå½“æ‚¨é¦–æ¬¡è®¿é—® `http://192.168.31.2:8090` æ—¶ä¼šè§¦å‘

**å¼¹çª—å†…å®¹**:
```
"HMusic" Would Like to Find and Connect to Devices on Your Local Network

HMusic éœ€è¦è®¿é—®æœ¬åœ°ç½‘ç»œä»¥è¿æ¥åˆ°éŸ³ä¹æœåŠ¡å™¨

[Don't Allow] [OK]
```

---

### 4. ç½‘ç»œå®‰å…¨é…ç½®
**é…ç½®æ–‡ä»¶**: `ios/Runner/Info.plist`

```xml
<key>NSAppTransportSecurity</key>
<dict>
    <key>NSAllowsArbitraryLoads</key>
    <true/>
    <key>NSAllowsLocalNetworking</key>
    <true/>
</dict>
```

**ä½œç”¨**:
- å…è®¸è®¿é—® HTTPï¼ˆé HTTPSï¼‰æœåŠ¡å™¨
- å…è®¸è®¿é—®æœ¬åœ°ç½‘ç»œåœ°å€

---

### 5. é€šçŸ¥æƒé™
**é…ç½®æ–‡ä»¶**: `ios/Runner/Info.plist`

```xml
<!-- iOS ä¸éœ€è¦åœ¨ Info.plist ä¸­å£°æ˜é€šçŸ¥æƒé™ -->
<!-- ç›´æ¥é€šè¿‡ä»£ç ç”³è¯·å³å¯ -->
```

**ç”³è¯·ä»£ç **: `lib/presentation/providers/initialization_provider.dart`

```dart
Future<void> _requestPermissions() async {
  final notificationStatus = await Permission.notification.request();
  debugPrint('ğŸ“± é€šçŸ¥æƒé™çŠ¶æ€: $notificationStatus');
}
```

**è§¦å‘æ—¶æœº**: åº”ç”¨å¯åŠ¨æ—¶ï¼Œåœ¨åˆå§‹åŒ–æµç¨‹ä¸­è‡ªåŠ¨ç”³è¯·

**å¼¹çª—å†…å®¹**:
```
"HMusic" Would Like to Send You Notifications

Notifications may include alerts, sounds and icon badges.
These can be configured in Settings.

[Don't Allow] [Allow]
```

---

### 6. åª’ä½“åº“è®¿é—®æƒé™
**é…ç½®æ–‡ä»¶**: `ios/Runner/Info.plist`

```xml
<key>NSAppleMusicUsageDescription</key>
<string>HMusic éœ€è¦è®¿é—®æ‚¨çš„åª’ä½“åº“ä»¥æ’­æ”¾éŸ³ä¹</string>
```

**è§¦å‘æ—¶æœº**: é¦–æ¬¡å°è¯•è®¿é—® Apple Music åº“æ—¶

---

### 7. éº¦å…‹é£æƒé™
**é…ç½®æ–‡ä»¶**: `ios/Runner/Info.plist`

```xml
<key>NSMicrophoneUsageDescription</key>
<string>HMusic éœ€è¦ä½¿ç”¨éº¦å…‹é£ä»¥æ”¯æŒè¯­éŸ³æ§åˆ¶åŠŸèƒ½</string>
```

**è§¦å‘æ—¶æœº**: é¦–æ¬¡å°è¯•ä½¿ç”¨éº¦å…‹é£æ—¶

---

## ğŸ” æƒé™ç”³è¯·æµç¨‹

### å¯åŠ¨æ—¶è‡ªåŠ¨ç”³è¯·çš„æƒé™

**iOSå¹³å°å¯åŠ¨æµç¨‹ï¼ˆå·²ä¼˜åŒ–ï¼Œé¿å…æƒé™å¼¹çª—å†²çªï¼‰**ï¼š
```
APPå¯åŠ¨ï¼ˆåŸç”Ÿå±‚ï¼‰
  â†“
1. ç«‹å³è§¦å‘ç½‘ç»œæƒé™è¯·æ±‚ï¼ˆåŸç”Ÿå±‚å‘èµ·HTTPè¯·æ±‚ï¼‰
  â†“
2. ç”¨æˆ·çœ‹åˆ°"æƒ³è¦ä½¿ç”¨æ•°æ®"å¼¹çª— â†’ ç”¨æˆ·é€‰æ‹©å…è®¸/æ‹’ç»
  â†“
3. ç­‰å¾…æƒé™å¼¹çª—å®Œå…¨å…³é—­ï¼ˆè¯·æ±‚å®Œæˆåé¢å¤–ç­‰å¾…1ç§’ï¼‰
  â†“
4. Flutterå¼•æ“å¼€å§‹åˆå§‹åŒ–
  â†“
5. æ£€æŸ¥åº”ç”¨æ›´æ–°ï¼ˆéœ€è¦ç½‘ç»œï¼‰
  â†“
6. å¦‚æœæœ‰æ›´æ–° â†’ æ˜¾ç¤ºæ›´æ–°é¡µé¢
   å¦‚æœæ— æ›´æ–° â†’ ç»§ç»­åˆå§‹åŒ–
  â†“
7. è¯·æ±‚é€šçŸ¥æƒé™
  â†“
8. é¦–æ¬¡è®¿é—®æœ¬åœ°IPæ—¶å¼¹å‡ºæœ¬åœ°ç½‘ç»œæƒé™ï¼ˆæ­¤æ—¶ç½‘ç»œæƒé™å·²å¤„ç†å®Œæ¯•ï¼Œä¸ä¼šå†²çªï¼‰
```

**Androidå¹³å°å¯åŠ¨æµç¨‹**ï¼š
```
APPå¯åŠ¨
  â†“
1. ç›´æ¥æ£€æŸ¥åº”ç”¨æ›´æ–°
  â†“
2. å¦‚æœæœ‰æ›´æ–° â†’ æ˜¾ç¤ºæ›´æ–°é¡µé¢
   å¦‚æœæ— æ›´æ–° â†’ ç»§ç»­åˆå§‹åŒ–
  â†“
3. è¯·æ±‚å…¶ä»–å¿…è¦æƒé™
```

### æƒé™ç”³è¯·æ—¶æœºæ€»ç»“
1. âœ… **ç½‘ç»œè®¿é—®æƒé™ï¼ˆå›½é™…åŒºiOSï¼‰** - APPå¯åŠ¨ç«‹å³è§¦å‘ï¼ˆæœ€æ—©ï¼‰
2. âœ… **ç‰ˆæœ¬æ›´æ–°æ£€æŸ¥** - ç½‘ç»œæƒé™æˆæƒåç«‹å³æ‰§è¡Œ
3. âœ… **é€šçŸ¥æƒé™** - æ— æ›´æ–°æ—¶åœ¨åˆå§‹åŒ–æµç¨‹ä¸­ç”³è¯·
4. âœ… **æœ¬åœ°ç½‘ç»œæƒé™** - é¦–æ¬¡è®¿é—®æœ¬åœ° IP æ—¶å¼¹å‡º
5. âœ… **åª’ä½“åº“æƒé™** - é¦–æ¬¡è®¿é—®åª’ä½“åº“æ—¶å¼¹å‡º
6. âœ… **éº¦å…‹é£æƒé™** - é¦–æ¬¡ä½¿ç”¨éº¦å…‹é£æ—¶å¼¹å‡º

---

## ğŸ› è°ƒè¯•æŠ€å·§

### æŸ¥çœ‹æƒé™ç”³è¯·æ—¥å¿—

è¿è¡Œåº”ç”¨åï¼Œåœ¨ Xcode æ§åˆ¶å°æˆ– `flutter run` è¾“å‡ºä¸­æŸ¥æ‰¾ï¼š

```
ğŸ“± [Initialization] å¼€å§‹è¯·æ±‚æƒé™...
ğŸ“± [Initialization] è¯·æ±‚é€šçŸ¥æƒé™...
ğŸ“± [Initialization] é€šçŸ¥æƒé™çŠ¶æ€: PermissionStatus.granted
ğŸ“± [Initialization] iOS æœ¬åœ°ç½‘ç»œæƒé™å°†åœ¨é¦–æ¬¡ç½‘ç»œè®¿é—®æ—¶è‡ªåŠ¨å¼¹å‡º
ğŸ“± [Initialization] æœ€ç»ˆæƒé™çŠ¶æ€:
   - é€šçŸ¥: PermissionStatus.granted
```

### é‡ç½®æƒé™æµ‹è¯•

å¦‚æœæƒ³é‡æ–°æµ‹è¯•æƒé™ç”³è¯·æµç¨‹ï¼š

1. **å¸è½½åº”ç”¨**
2. **é‡å¯è®¾å¤‡**ï¼ˆå¯é€‰ï¼Œä½†æ¨èï¼‰
3. **é‡æ–°å®‰è£…åº”ç”¨**

æˆ–è€…ï¼š

1. æ‰“å¼€ **è®¾ç½® > é€šç”¨ > è½¬ç§»æˆ–è¿˜åŸ iPhone**
2. é€‰æ‹© **æŠ¹æ‰æ‰€æœ‰å†…å®¹å’Œè®¾ç½®**ï¼ˆä»…ç”¨äºæµ‹è¯•è®¾å¤‡ï¼‰

---

## âš ï¸ å¸¸è§é—®é¢˜

### Q: ä¸ºä»€ä¹ˆæ²¡æœ‰çœ‹åˆ°ç½‘ç»œæƒé™ç”³è¯·ï¼Ÿ
**A**:
- **ä¸­å›½åŒºiOS**: åº”ç”¨é»˜è®¤å¯ä»¥è®¿é—®ç½‘ç»œï¼Œä¸ä¼šå¼¹å‡ºæƒé™å¯¹è¯æ¡†
- **å›½é™…åŒºiOS**: é¦–æ¬¡å®‰è£…æ—¶ä¼šåœ¨åº”ç”¨å¯åŠ¨æ—¶å¼¹å‡º"WiFiä¸èœ‚çªæ•°æ®"é€‰æ‹©å¯¹è¯æ¡†

### Q: å›½é™…åŒºiOSç½‘ç»œæƒé™è¢«æ‹’ç»æ€ä¹ˆåŠï¼Ÿ
**A**:
1. æ‰“å¼€ **è®¾ç½® > HMusic**
2. æ‰¾åˆ° **èœ‚çªæ•°æ®** æˆ– **æ— çº¿å±€åŸŸç½‘ä¸èœ‚çªæ•°æ®** é€‰é¡¹
3. é€‰æ‹©å…è®¸è®¿é—®çš„ç½‘ç»œç±»å‹ï¼ˆWiFiã€èœ‚çªæ•°æ®æˆ–ä¸¤è€…ï¼‰
4. é‡å¯åº”ç”¨

### Q: ä¸ºä»€ä¹ˆæœ¬åœ°ç½‘ç»œæƒé™æ²¡æœ‰åœ¨å¯åŠ¨æ—¶å¼¹å‡ºï¼Ÿ
**A**: è¿™æ˜¯ iOS çš„è®¾è®¡ã€‚æœ¬åœ°ç½‘ç»œæƒé™åªåœ¨**é¦–æ¬¡å°è¯•è®¿é—®æœ¬åœ°ç½‘ç»œåœ°å€**æ—¶æ‰ä¼šå¼¹å‡ºã€‚

### Q: å¦‚ä½•ç¡®è®¤æœ¬åœ°ç½‘ç»œæƒé™å·²æˆäºˆï¼Ÿ
**A**:
1. æ‰“å¼€ **è®¾ç½® > HMusic**
2. æŸ¥çœ‹ **æœ¬åœ°ç½‘ç»œ** é€‰é¡¹æ˜¯å¦å·²å¼€å¯
3. æˆ–è€…æŸ¥çœ‹åº”ç”¨é¦–æ¬¡è®¿é—®æœ¬åœ° IP æ—¶æ˜¯å¦å¼¹å‡ºå¯¹è¯æ¡†

### Q: é€šçŸ¥æƒé™è¢«æ‹’ç»äº†æ€ä¹ˆåŠï¼Ÿ
**A**:
1. æ‰“å¼€ **è®¾ç½® > HMusic > é€šçŸ¥**
2. æ‰‹åŠ¨å¼€å¯é€šçŸ¥æƒé™
3. é‡å¯åº”ç”¨

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Apple: Requesting Authorization for Media Playback](https://developer.apple.com/documentation/avfoundation/media_playback/creating_a_basic_video_player_ios_and_tvos/enabling_background_audio)
- [Apple: Local Network Privacy](https://developer.apple.com/videos/play/wwdc2020/10110/)
- [permission_handler æ’ä»¶æ–‡æ¡£](https://pub.dev/packages/permission_handler)

---

---

## ğŸŒ å›½é™…åŒºä¸ä¸­å›½åŒºå·®å¼‚

| æƒé™ç±»å‹ | ä¸­å›½åŒºiOS | å›½é™…åŒºiOS |
|---------|----------|----------|
| äº’è”ç½‘è®¿é—® | é»˜è®¤å…è®¸ | éœ€è¦ç”¨æˆ·æˆæƒ |
| æœ¬åœ°ç½‘ç»œ | é¦–æ¬¡è®¿é—®æ—¶å¼¹å‡º | é¦–æ¬¡è®¿é—®æ—¶å¼¹å‡º |
| é€šçŸ¥ | éœ€è¦æˆæƒ | éœ€è¦æˆæƒ |
| åª’ä½“åº“ | é¦–æ¬¡è®¿é—®æ—¶å¼¹å‡º | é¦–æ¬¡è®¿é—®æ—¶å¼¹å‡º |

**æœ€åæ›´æ–°**: 2025-10-10
