# HMusic V2.0.0 - 重大版本更新 🎉

> 从 NAS 音乐控制器到全能音乐播放器的进化

## 🚀 重大功能

### ✅ 本地播放支持
- 手机本地音乐播放，本地/远程模式智能切换
- 本地音乐自动扫描和播放列表管理
- 播放状态完整保持和恢复
- 修复本地播放进度抖动和切歌问题

### ✅ 应用内更新系统
- 基于 LeanCloud 的自动检测和推送
- 支持强制/可选更新策略
- 版本对比和更新日志展示
- 启动时优先检测，避免进入主界面后才提示

### ✅ 封面图功能
- 完整封面显示和主色调自适应光圈
- 本地/远程封面智能搜索
- 首次播放封面加载优化
- 防抖机制避免频繁请求

### ✅ 音乐下载优化
- 支持多音质选择（无损/高品质/标准）
- 智能音质降级机制
- 下载到公共 Download/HMusic 目录
- 修复连续下载权限问题

---

## 🎨 品牌升级

### 应用更名为 HMusic
- **包名变更**：`com.xiaomi.music` → `com.hupc.hmusic`
- **全新 SVG logo** 和应用图标设计
- **应用图标优化**：内边距优化，显示更大更清晰
- **原生启动屏**：替代 Flutter 加载页，启动更流畅

---

## 📱 体验优化

### 播放通知栏支持
- 多平台播放通知栏（Android/iOS）
- 实时状态同步和控制
- 设备切换后自动刷新

### 当前播放列表
- 播放列表显示和高亮当前播放
- 快速定位正在播放的歌曲

### UI 全面优化
- 封面主色调自适应光圈和应用信息展示
- 登录页面 UX 优化（清除按钮、提交动作、密码切换）
- 搜索框位置统一对齐
- 底部 Dock 栏适配手势提示线
- 设置页面图标样式统一

### 文案优化
- 音箱 → 播放设备
- 控制 → 播放
- 下载音质 UI 对齐和体验优化

---

## 🐛 问题修复

### 播放相关
- ✅ 修复重启后本地播放无法切歌问题
- ✅ 修复本地播放时上一曲/下一曲功能
- ✅ 修复本地播放进度抖动问题
- ✅ 修复设备切换后状态覆盖问题
- ✅ 修复首次播放封面不加载问题
- ✅ 修复封面搜索逻辑和防抖机制

### 下载相关
- ✅ 修复连续下载时权限检查失败
- ✅ 修复 Android 存储权限问题
- ✅ 优化下载路径为公共 Download 目录

### 其他修复
- ✅ 修复更新页面"稍后"按钮黑屏问题
- ✅ 修复 JS 音源解析逻辑 Bug
- ✅ 修复搜索结果封面图清空问题
- ✅ 修复登出后导航问题

---

## 🔧 技术改进

- AudioService 全局初始化优化
- 通知权限请求优化
- 存储权限动态请求
- 本地播放策略重构
- LeanCloud 远程配置集成
- JS 脚本预加载优化
- 设备管理和设置页面优化

---

## 📦 版本信息

- **版本号**：1.2.1 → 2.0.0
- **发布日期**：2025-01-09
- **包名**：com.hupc.hmusic
- **最低支持**：Android 5.0+ / iOS 12.0+

---

## 📥 下载

从 [Releases](https://github.com/hpcll/XiaoMi_Music_Client/releases/tag/v2.0.0) 页面下载最新版本。

---

## ⚠️ 重要提示

- 由于包名变更，从旧版本升级需要**卸载后重新安装**
- 首次安装需要重新登录并配置服务器信息
- 建议备份重要的播放列表和设置

---

## 🙏 致谢

感谢所有用户的反馈和建议，让 HMusic 变得更好！

如有问题或建议，欢迎在 [Issues](https://github.com/hpcll/XiaoMi_Music_Client/issues) 中反馈。
