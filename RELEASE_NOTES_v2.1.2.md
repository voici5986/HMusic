# HMusic v2.1.2 版本更新说明

> 发布日期：2025年1月14日

## 🎉 版本亮点

本次更新主要聚焦于**用户体验优化**和**智能功能增强**，带来了全新的赞赏引导系统、更智能的歌词匹配，以及播放列表功能的全面优化。

---

## ✨ 新功能

### 1. 赞赏引导系统 ❤️

为了让应用持续发展，我们增加了温和且人性化的赞赏引导功能：

- **智能里程碑提示**
  - 🎵 播放 50 首歌曲时的祝贺
  - 📝 自动获取 20 条歌词时的感谢
  - ⏰ 使用应用满 7 天的陪伴提醒
  - 🔔 每 30 天的温馨提示（可关闭）

- **精美的赞赏弹窗**
  - 渐变背景设计，视觉温和
  - 明确的按钮选项（赞赏/稍后/不再提醒）
  - 一次只显示一个提示，不打扰用户

- **醒目的赞赏入口**
  - 首页顶部新增粉色爱心按钮 💗
  - 启动 3 秒后播放心跳动画（仅 3 次）
  - 点击直达赞赏支持页面

### 2. 智能歌词匹配增强 🎤

全新的歌词匹配算法，支持更多本地音乐文件命名格式：

- **多格式支持**
  - ✅ "歌名 - 歌手" 格式（标准格式）
  - ✅ "歌手 - 歌名" 格式（部分本地文件）

- **智能格式识别**
  - 自动尝试两种格式进行搜索
  - 首次无结果时自动反转格式重试
  - 详细的调试日志，便于问题排查

- **精准匹配策略**
  - 🥇 完美匹配：歌名 + 艺术家都匹配
  - 🥈 次优匹配：仅艺术家名称匹配
  - 🥉 备选方案：使用第一个搜索结果

- **匹配精度提升**
  - 支持完全匹配和包含关系
  - 自动处理大小写和空格
  - 提高歌词获取成功率

### 3. 播放列表功能优化 📋

播放列表系统的全面升级，带来更好的管理体验：

- **虚拟播放列表识别**
  - 自动识别系统列表（下载/全部/所有歌曲/临时搜索/在线播放/最近新增）
  - 虚拟列表隐藏"移动到"操作，避免误操作
  - 播放列表选择器自动过滤虚拟列表

- **歌曲详情增强**
  - 曲库页面显示歌曲所属播放列表
  - 新增"添加到..."快捷操作
  - 方便快速管理歌曲归属

- **移动操作优化**
  - 增加删除结果检查机制
  - 操作失败自动回滚
  - 统一成功提示为绿色背景

---

## 🎨 界面优化

### 视觉一致性提升

- **统一列表样式**
  - 曲库页面、播放列表主页、播放列表详情页使用一致的浅灰色背景
  - 移除 Card 组件阴影，采用清爽的边框设计
  - 整体视觉更加简洁统一

- **赞赏支持页面**
  - 统一 AppBar 样式与其他设置页面一致
  - 标题居中显示，视觉更和谐

- **提示信息优化**
  - 统一成功提示的绿色背景（已添加到/已移动到/已复制到）
  - 提示信息更加直观明确

---

## 🔧 体验改进

### 用户体验细节

- **延迟加载策略**
  - 应用启动 2 秒后才检查里程碑，不打扰启动过程
  - 心跳动画延迟 3 秒播放，避免过于突兀

- **不打扰原则**
  - 一次只显示一个提示弹窗
  - 用户可选择"不再提醒"永久关闭
  - 30 天间隔提醒，频率合理

- **数据持久化**
  - 使用统计数据本地保存
  - 应用重启后数据不丢失
  - 自动累计使用记录

### 后台播放优化

- 修复 Android 通知配置
- 改善后台播放体验
- 优化音频服务稳定性

---

## 🐛 问题修复

- 修复播放列表移动操作未检查删除结果的问题
- 修复 PlaylistAdapter 未包含歌曲列表数据的问题
- 修复歌词匹配逻辑对特殊命名格式的支持问题
- 修复虚拟播放列表的识别和处理逻辑

---

## 📦 技术改进

### 架构优化

- 新增 `UsageStatsProvider` 使用统计追踪系统
- 新增 `SponsorPromptDialog` 精美提示弹窗组件
- 优化 `LyricService` 歌词匹配算法
- 改进 `PlaylistProvider` 播放列表管理逻辑

### 代码质量

- 增强艺术家名称匹配精度
- 添加详细的调试日志
- 优化状态管理流程
- 提升代码可维护性

---

## 📈 数据统计

本次更新共：
- ✅ 新增 2 个文件
- ✅ 修改 7 个文件
- ✅ 新增约 470 行代码
- ✅ 优化 3 个核心功能模块

---

## 🙏 致谢

感谢所有用户的支持与反馈！如果您觉得应用有帮助，欢迎通过以下方式支持我们：

- ⭐ 在 GitHub 上给项目点个 Star
- 💗 通过应用内赞赏支持开发者
- 📢 推荐给身边的朋友
- 💬 提供宝贵的意见和建议

---

## 📱 下载更新

- **GitHub Release**: [查看发布页面](https://github.com/hpcll/HMusic/releases/tag/v2.1.2)
- **应用内更新**: 打开应用，检查更新

---

## 🔗 相关链接

- **项目主页**: https://github.com/hpcll/HMusic
- **问题反馈**: https://github.com/hpcll/HMusic/issues
- **更新日志**: [CHANGELOG.md](./CHANGELOG.md)

---

**HMusic 团队**
*让音乐控制更简单* 🎵
