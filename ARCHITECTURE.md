# HMusic åŒæ¨¡å¼æ¶æ„è®¾è®¡æ–‡æ¡£

> è¯¦ç»†è¯´æ˜HMusicåŒæ¨¡å¼åŠŸèƒ½çš„æ¶æ„è®¾è®¡ã€å®ç°æ€è·¯å’ŒæŠ€æœ¯ç»†èŠ‚
>
> **ä½œè€…**: å“ˆé›·é…± (ï¿£â–½ï¿£)ï¼
> **åˆ›å»ºæ—¥æœŸ**: 2025-11-20
> **ç‰ˆæœ¬**: v1.0

---

## ğŸ“– ç›®å½•

1. [è®¾è®¡ç›®æ ‡](#è®¾è®¡ç›®æ ‡)
2. [æ¶æ„æ¦‚è§ˆ](#æ¶æ„æ¦‚è§ˆ)
3. [æ ¸å¿ƒæ¦‚å¿µ](#æ ¸å¿ƒæ¦‚å¿µ)
4. [è¯¦ç»†è®¾è®¡](#è¯¦ç»†è®¾è®¡)
5. [æ•°æ®æµ](#æ•°æ®æµ)
6. [æŠ€æœ¯å†³ç­–](#æŠ€æœ¯å†³ç­–)
7. [æ‰©å±•æ€§è®¾è®¡](#æ‰©å±•æ€§è®¾è®¡)

---

## ğŸ¯ è®¾è®¡ç›®æ ‡

### ä¸šåŠ¡ç›®æ ‡

1. **æ‰©å¤§ç”¨æˆ·ç¾¤ä½“**
   - è®©æ²¡æœ‰NAS/æœåŠ¡å™¨çš„æ™®é€šç”¨æˆ·ä¹Ÿèƒ½ä½¿ç”¨HMusic
   - ä¿ç•™é«˜çº§ç”¨æˆ·çš„å®Œæ•´åŠŸèƒ½

2. **é™ä½ä½¿ç”¨é—¨æ§›**
   - ç›´è¿æ¨¡å¼æ— éœ€éƒ¨ç½²æœåŠ¡ç«¯
   - åªéœ€å°ç±³è´¦å·å³å¯ä½¿ç”¨

3. **ä¿æŒåŠŸèƒ½å®Œæ•´**
   - xiaomusicæ¨¡å¼ä¿æŒæ‰€æœ‰åŸæœ‰åŠŸèƒ½
   - ä¸¤ç§æ¨¡å¼å¯ä»¥è‡ªç”±åˆ‡æ¢

### æŠ€æœ¯ç›®æ ‡

1. **é›¶ç ´åæ€§é›†æˆ**
   - ä¸ä¿®æ”¹ç°æœ‰æ ¸å¿ƒä»£ç é€»è¾‘
   - å®Œå…¨å…¼å®¹ç°æœ‰æ¶æ„

2. **å¯ç»´æŠ¤æ€§**
   - ä»£ç æ¸…æ™°ï¼ŒèŒè´£åˆ†æ˜
   - éµå¾ªSOLIDåŸåˆ™

3. **å¯æ‰©å±•æ€§**
   - æ˜“äºæ·»åŠ æ–°çš„æ’­æ”¾æ¨¡å¼
   - æ˜“äºæ‰©å±•åŠŸèƒ½

---

## ğŸ—ï¸ æ¶æ„æ¦‚è§ˆ

### æ•´ä½“æ¶æ„å›¾

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        HMusic Application                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         UI Layer (Flutter)                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚ Mode Selection   â”‚  â”‚  Direct Login    â”‚                   â”‚
â”‚  â”‚     Page         â”‚  â”‚      Page        â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                   â”‚
â”‚  â”‚  Xiaomusi Login  â”‚  â”‚   Search Page    â”‚                   â”‚
â”‚  â”‚     Page         â”‚  â”‚  (Existing)      â”‚                   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    Provider Layer (Riverpod)                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚   Playback     â”‚  â”‚   Direct       â”‚  â”‚      Auth       â”‚  â”‚
â”‚  â”‚   Mode         â”‚  â”‚   Mode         â”‚  â”‚   (xiaomusic)   â”‚  â”‚
â”‚  â”‚   Provider     â”‚  â”‚   Provider     â”‚  â”‚    Provider     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚            Playback Provider (Existing)                 â”‚   â”‚
â”‚  â”‚  - Manages playback state                              â”‚   â”‚
â”‚  â”‚  - Delegates to strategy                               â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                Strategy Pattern (Playback Control)              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚        PlaybackStrategy Interface (Existing)            â”‚   â”‚
â”‚  â”‚  - play() / pause() / next() / previous()              â”‚   â”‚
â”‚  â”‚  - playMusic() / getCurrentStatus() / getVolume()      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚           â†“                                      â†“              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Remote Playback    â”‚          â”‚  MiIoT Direct Playback   â”‚â”‚
â”‚  â”‚  Strategy           â”‚          â”‚  Strategy (NEW)          â”‚â”‚
â”‚  â”‚  (Existing)         â”‚          â”‚                          â”‚â”‚
â”‚  â”‚  - via xiaomusic    â”‚          â”‚  - Direct to Mi IoT API  â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Service Layer                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  Music API Service  â”‚          â”‚  Mi IoT Service (NEW)    â”‚â”‚
â”‚  â”‚  (Existing)         â”‚          â”‚  - Login to Mi Account   â”‚â”‚
â”‚  â”‚  - xiaomusic API    â”‚          â”‚  - Get device list       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â”‚  - Play music via URL    â”‚â”‚
â”‚           â†“                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                      â†“                â”‚
â”‚  â”‚  DioClient          â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  (HTTP)             â”‚          â”‚  Dio (HTTP)              â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                       External Services                         â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”â”‚
â”‚  â”‚  xiaomusic Server   â”‚          â”‚  Xiaomi IoT Cloud API    â”‚â”‚
â”‚  â”‚  (User's NAS)       â”‚          â”‚  (api.mina.mi.com)       â”‚â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                      Xiaomi AI Speaker                          â”‚
â”‚                    ğŸ”Š Playing Music                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§© æ ¸å¿ƒæ¦‚å¿µ

### 1. ç­–ç•¥æ¨¡å¼ (Strategy Pattern)

**å®šä¹‰**: å®šä¹‰ä¸€ç³»åˆ—ç®—æ³•ï¼ŒæŠŠå®ƒä»¬ä¸€ä¸ªä¸ªå°è£…èµ·æ¥ï¼Œå¹¶ä¸”ä½¿å®ƒä»¬å¯ä»¥ç›¸äº’æ›¿æ¢ã€‚

**åœ¨HMusicä¸­çš„åº”ç”¨**:

```dart
// ç­–ç•¥æ¥å£ï¼ˆå·²å­˜åœ¨ï¼‰
abstract class PlaybackStrategy {
  Future<void> play();
  Future<void> pause();
  Future<void> playMusic({
    required String musicName,
    String? url,
    String? platform,
    String? songId,
  });
  // ... å…¶ä»–æ–¹æ³•
}

// ç­–ç•¥1ï¼šxiaomusicæ¨¡å¼ï¼ˆå·²å­˜åœ¨ï¼‰
class RemotePlaybackStrategy implements PlaybackStrategy {
  final MusicApiService _apiService;
  // é€šè¿‡xiaomusicæœåŠ¡ç«¯æ§åˆ¶
}

// ç­–ç•¥2ï¼šç›´è¿æ¨¡å¼ï¼ˆæ–°å¢ï¼‰
class MiIoTDirectPlaybackStrategy implements PlaybackStrategy {
  final MiIoTService _miService;
  // ç›´æ¥è°ƒç”¨å°ç±³IoT API
}

// Contextï¼šPlaybackProvider
class PlaybackNotifier {
  PlaybackStrategy? _currentStrategy;

  // æ ¹æ®æ¨¡å¼é€‰æ‹©ç­–ç•¥
  Future<void> _initializeStrategy() {
    if (mode == xiaomusic) {
      _currentStrategy = RemotePlaybackStrategy(...);
    } else {
      _currentStrategy = MiIoTDirectPlaybackStrategy(...);
    }
  }
}
```

**ä¼˜åŠ¿**:
- âœ… ç¬¦åˆå¼€é—­åŸåˆ™ï¼ˆå¯¹æ‰©å±•å¼€æ”¾ï¼Œå¯¹ä¿®æ”¹å…³é—­ï¼‰
- âœ… æ˜“äºæ·»åŠ æ–°çš„æ’­æ”¾æ¨¡å¼
- âœ… ç­–ç•¥ä¹‹é—´ç›¸äº’ç‹¬ç«‹

### 2. çŠ¶æ€ç®¡ç†æ¨¡å¼

**ä½¿ç”¨Riverpodè¿›è¡ŒçŠ¶æ€ç®¡ç†**:

```dart
// 1. æ’­æ”¾æ¨¡å¼é€‰æ‹©çŠ¶æ€
enum PlaybackMode { xiaomusic, miIoTDirect }

final playbackModeProvider = StateNotifierProvider<...>((ref) {
  return PlaybackModeNotifier();
});

// 2. ç›´è¿æ¨¡å¼é…ç½®çŠ¶æ€
sealed class DirectModeState {}
class DirectModeAuthenticated extends DirectModeState {
  final MiIoTService miService;
  final List<MiDevice> devices;
}

final directModeProvider = StateNotifierProvider<...>((ref) {
  return DirectModeNotifier();
});

// 3. æ’­æ”¾çŠ¶æ€ï¼ˆå·²å­˜åœ¨ï¼‰
final playbackProvider = StateNotifierProvider<...>((ref) {
  return PlaybackNotifier(ref);
});
```

**çŠ¶æ€æµè½¬**:

```
[åˆå§‹åŒ–] â†’ [é€‰æ‹©æ¨¡å¼] â†’ [ç™»å½•/è¿æ¥] â†’ [æ’­æ”¾æ§åˆ¶]

xiaomusicæ¨¡å¼:
  AuthInitial â†’ AuthLoading â†’ AuthAuthenticated â†’ Ready to Play

ç›´è¿æ¨¡å¼:
  DirectModeInitial â†’ DirectModeLoading â†’ DirectModeAuthenticated â†’ Ready to Play
```

### 3. ä¾èµ–æ³¨å…¥

**é€šè¿‡Riverpodçš„Providerå®ç°ä¾èµ–æ³¨å…¥**:

```dart
// Serviceå±‚
final miIoTServiceProvider = Provider<MiIoTService>((ref) {
  return MiIoTService();
});

// Strategyå±‚
final playbackStrategyProvider = Provider<PlaybackStrategy>((ref) {
  final mode = ref.watch(playbackModeProvider);

  if (mode == PlaybackMode.miIoTDirect) {
    final directState = ref.watch(directModeProvider);
    if (directState is DirectModeAuthenticated) {
      return MiIoTDirectPlaybackStrategy(
        miService: directState.miService,
        deviceId: directState.devices.first.deviceId,
      );
    }
  }

  // Fallback to xiaomusic
  return RemotePlaybackStrategy(...);
});
```

---

## ğŸ” è¯¦ç»†è®¾è®¡

### æ¨¡å—1: Mi IoT Service

**èŒè´£**: å°è£…å°ç±³IoTäº‘ç«¯APIè°ƒç”¨

**å…³é”®æ–¹æ³•**:

```dart
class MiIoTService {
  /// ç™»å½•å°ç±³è´¦å·
  /// 1. è·å–ç™»å½•sign
  /// 2. æäº¤è´¦å·å¯†ç 
  /// 3. ä»Cookieæå–serviceToken
  Future<bool> login(String account, String password);

  /// è·å–è®¾å¤‡åˆ—è¡¨
  /// è°ƒç”¨ api.mina.mi.com/admin/v2/device_list
  Future<List<MiDevice>> getDevices();

  /// æ’­æ”¾éŸ³ä¹
  /// è°ƒç”¨ api.mina.mi.com/remote/ubus
  /// message: player_play_url æˆ– player_play_music
  Future<bool> playMusic({
    required String deviceId,
    required String musicUrl,
    bool compatMode = false,
  });

  /// æš‚åœæ’­æ”¾
  Future<bool> pause(String deviceId);

  /// ç»§ç»­æ’­æ”¾
  Future<bool> resume(String deviceId);
}
```

**APIè°ƒç”¨æµç¨‹**:

```
ç™»å½•æµç¨‹:
  1. GET https://account.xiaomi.com/pass/serviceLogin?sid=micoapi
     â†’ è·å– _sign

  2. POST https://account.xiaomi.com/pass/serviceLoginAuth2
     Body: {user, hash(MD5), sid, _sign}
     â†’ è·å– location URL

  3. GET location URL
     â†’ ä»Cookieè·å– serviceToken å’Œ userId

æ’­æ”¾éŸ³ä¹:
  POST https://api.mina.mi.com/remote/ubus
  Query: ?deviceId=xxx&message=player_play_url&path=mediaplayer
  Headers: Cookie: serviceToken=xxx; userId=xxx
  Body: {"url": "éŸ³ä¹URL"}
```

**é”™è¯¯å¤„ç†**:

```dart
try {
  final success = await miService.login(account, password);
  if (!success) {
    // ç™»å½•å¤±è´¥ - è´¦å·å¯†ç é”™è¯¯
    return DirectModeError('ç™»å½•å¤±è´¥ï¼Œè¯·æ£€æŸ¥è´¦å·å¯†ç ');
  }
} catch (e) {
  // ç½‘ç»œå¼‚å¸¸
  return DirectModeError('ç½‘ç»œé”™è¯¯: $e');
}
```

### æ¨¡å—2: MiIoTDirectPlaybackStrategy

**èŒè´£**: å®ç°PlaybackStrategyæ¥å£ï¼Œä½¿ç”¨MiIoTServiceæ§åˆ¶æ’­æ”¾

**æ ¸å¿ƒå®ç°**:

```dart
class MiIoTDirectPlaybackStrategy implements PlaybackStrategy {
  final MiIoTService _miService;
  final String _deviceId;
  PlayingMusic? _currentPlayingMusic;

  @override
  Future<void> playMusic({
    required String musicName,
    String? url,
    ...
  }) async {
    // 1. éªŒè¯URL
    if (url == null || url.isEmpty) {
      return;
    }

    // 2. è°ƒç”¨Mi IoT API
    final success = await _miService.playMusic(
      deviceId: _deviceId,
      musicUrl: url,
    );

    if (success) {
      // 3. æ›´æ–°æœ¬åœ°çŠ¶æ€
      _currentPlayingMusic = PlayingMusic(
        isPlaying: true,
        curMusic: musicName,
        duration: 0, // ç›´è¿æ¨¡å¼æ— æ³•è·å–
        offset: 0,
      );

      // 4. æ›´æ–°é€šçŸ¥æ 
      _updateNotification();

      // 5. è§¦å‘å›è°ƒ
      onStatusChanged?.call();
    }
  }

  @override
  Future<void> pause() async {
    await _miService.pause(_deviceId);
    _updateNotificationState(isPlaying: false);
  }
}
```

**ä¸RemotePlaybackStrategyçš„å¯¹æ¯”**:

| ç‰¹æ€§ | RemotePlaybackStrategy | MiIoTDirectPlaybackStrategy |
|------|----------------------|----------------------------|
| æ•°æ®æº | xiaomusicæœåŠ¡ç«¯ | å°ç±³IoTäº‘ç«¯ |
| æ’­æ”¾çŠ¶æ€ | å¯å®æ—¶æŸ¥è¯¢ | æ— æ³•æŸ¥è¯¢ï¼ˆä»…æœ¬åœ°ç¼“å­˜ï¼‰ |
| æ’­æ”¾è¿›åº¦ | å¯è·å– | æ— æ³•è·å– |
| éŸ³é‡æ§åˆ¶ | æ”¯æŒ | ä¸æ”¯æŒ |
| ä¸Šä¸€æ›²/ä¸‹ä¸€æ›² | æ”¯æŒ | ä¸æ”¯æŒ |
| æ’­æ”¾åˆ—è¡¨ | æ”¯æŒ | ä¸æ”¯æŒ |

### æ¨¡å—3: DirectModeProvider

**èŒè´£**: ç®¡ç†ç›´è¿æ¨¡å¼çš„ç™»å½•çŠ¶æ€å’Œé…ç½®

**çŠ¶æ€å®šä¹‰**:

```dart
// ä½¿ç”¨sealed classç¡®ä¿ç±»å‹å®‰å…¨
sealed class DirectModeState {}

class DirectModeInitial extends DirectModeState {
  // æœªç™»å½•
}

class DirectModeLoading extends DirectModeState {
  // ç™»å½•ä¸­
}

class DirectModeAuthenticated extends DirectModeState {
  final MiIoTService miService;  // å·²ç™»å½•çš„æœåŠ¡å®ä¾‹
  final String account;          // è´¦å·
  final List<MiDevice> devices;  // è®¾å¤‡åˆ—è¡¨
}

class DirectModeError extends DirectModeState {
  final String message;          // é”™è¯¯ä¿¡æ¯
}
```

**Notifierå®ç°**:

```dart
class DirectModeNotifier extends StateNotifier<DirectModeState> {
  DirectModeNotifier() : super(const DirectModeInitial()) {
    _loadSavedCredentials(); // è‡ªåŠ¨åŠ è½½ä¿å­˜çš„å‡­è¯
  }

  /// ç™»å½•
  Future<void> login({
    required String account,
    required String password,
    bool saveCredentials = true,
  }) async {
    state = const DirectModeLoading();

    try {
      // 1. åˆ›å»ºæœåŠ¡å®ä¾‹
      final miService = MiIoTService();

      // 2. ç™»å½•
      final success = await miService.login(account, password);
      if (!success) {
        state = const DirectModeError('ç™»å½•å¤±è´¥');
        return;
      }

      // 3. è·å–è®¾å¤‡
      final devices = await miService.getDevices();
      if (devices.isEmpty) {
        state = const DirectModeError('æœªæ‰¾åˆ°è®¾å¤‡');
        return;
      }

      // 4. ä¿å­˜å‡­è¯
      if (saveCredentials) {
        await _saveCredentials(account, password);
      }

      // 5. æ›´æ–°çŠ¶æ€
      state = DirectModeAuthenticated(
        miService: miService,
        account: account,
        devices: devices,
      );

    } catch (e) {
      state = DirectModeError('ç™»å½•å¼‚å¸¸: $e');
    }
  }
}
```

**é…ç½®æŒä¹…åŒ–**:

```dart
// ä½¿ç”¨SharedPreferencesä¿å­˜
static const _keyAccount = 'direct_mode_account';
static const _keyPassword = 'direct_mode_password';

Future<void> _saveCredentials(String account, String password) async {
  final prefs = await SharedPreferences.getInstance();
  await prefs.setString(_keyAccount, account);
  await prefs.setString(_keyPassword, password);
}

Future<void> _loadSavedCredentials() async {
  final prefs = await SharedPreferences.getInstance();
  final account = prefs.getString(_keyAccount);
  final password = prefs.getString(_keyPassword);

  if (account != null && password != null) {
    await _silentLogin(account, password);
  }
}
```

---

## ğŸŒŠ æ•°æ®æµ

### åœºæ™¯1: ç”¨æˆ·é€‰æ‹©ç›´è¿æ¨¡å¼å¹¶ç™»å½•

```
1. ç”¨æˆ·æ‰“å¼€APP
   â””â”€> InitializationProvider åˆå§‹åŒ–
       â””â”€> PlaybackModeProvider åŠ è½½ä¿å­˜çš„æ¨¡å¼

2. ç”¨æˆ·é€‰æ‹©ç›´è¿æ¨¡å¼
   â””â”€> PlaybackModeSelectionPage æ˜¾ç¤º
       â””â”€> ç”¨æˆ·ç‚¹å‡»"ç›´è¿æ¨¡å¼"
           â””â”€> playbackModeProvider.setMode(PlaybackMode.miIoTDirect)
               â””â”€> ä¿å­˜åˆ° SharedPreferences
               â””â”€> è·³è½¬åˆ° DirectModeLoginPage

3. ç”¨æˆ·è¾“å…¥è´¦å·å¯†ç ç™»å½•
   â””â”€> directModeProvider.notifier.login(account, password)
       â”œâ”€> state = DirectModeLoading
       â”œâ”€> miService.login(account, password)
       â”‚   â”œâ”€> HTTPè¯·æ±‚å°ç±³ç™»å½•API
       â”‚   â””â”€> è·å– serviceToken
       â”œâ”€> miService.getDevices()
       â”‚   â”œâ”€> HTTPè¯·æ±‚è®¾å¤‡åˆ—è¡¨API
       â”‚   â””â”€> è¿”å› List<MiDevice>
       â”œâ”€> ä¿å­˜å‡­è¯åˆ° SharedPreferences
       â””â”€> state = DirectModeAuthenticated(miService, account, devices)

4. ç™»å½•æˆåŠŸ
   â””â”€> DirectModeLoginPage ç›‘å¬çŠ¶æ€å˜åŒ–
       â””â”€> è·³è½¬åˆ°ä¸»é¡µ
```

### åœºæ™¯2: ç”¨æˆ·æ’­æ”¾éŸ³ä¹

```
1. ç”¨æˆ·æœç´¢éŸ³ä¹
   â””â”€> MusicSearchProvider æœç´¢
       â””â”€> UnifiedApiService è°ƒç”¨éŸ³ä¹å¹³å°API
           â””â”€> è¿”å› List<OnlineMusicResult>
               â””â”€> åŒ…å« {title, author, url, platform, songId}

2. ç”¨æˆ·ç‚¹å‡»æ’­æ”¾
   â””â”€> playbackProvider.notifier.playOnlineMusic(music)
       â”œâ”€> æ£€æŸ¥ _currentStrategy æ˜¯å¦å·²åˆå§‹åŒ–
       â”‚   â””â”€> å¦‚æœæœªåˆå§‹åŒ–ï¼Œè°ƒç”¨ _initializeStrategy()
       â”‚       â”œâ”€> è¯»å– playbackModeProvider
       â”‚       â””â”€> å¦‚æœæ˜¯ miIoTDirect:
       â”‚           â”œâ”€> è¯»å– directModeProvider
       â”‚           â””â”€> åˆ›å»º MiIoTDirectPlaybackStrategy
       â”‚               â”œâ”€> miService (from directModeProvider)
       â”‚               â”œâ”€> deviceId (ç¬¬ä¸€ä¸ªè®¾å¤‡)
       â”‚               â””â”€> audioHandler (for notification)
       â”‚
       â””â”€> _currentStrategy.playMusic(
             musicName: '${music.title} - ${music.author}',
             url: music.url,
           )
           â”œâ”€> MiIoTDirectPlaybackStrategy.playMusic()
           â”‚   â”œâ”€> miService.playMusic(deviceId, musicUrl)
           â”‚   â”‚   â””â”€> HTTP POST api.mina.mi.com/remote/ubus
           â”‚   â”‚       Body: {"url": musicUrl}
           â”‚   â”‚       Headers: Cookie with serviceToken
           â”‚   â”‚
           â”‚   â”œâ”€> æ›´æ–°æœ¬åœ°çŠ¶æ€ _currentPlayingMusic
           â”‚   â”œâ”€> æ›´æ–°é€šçŸ¥æ  AudioHandler
           â”‚   â””â”€> è§¦å‘å›è°ƒ onStatusChanged()
           â”‚
           â””â”€> playbackProvider._refreshStatus()
               â””â”€> state = state.copyWith(
                     currentMusic: _currentPlayingMusic,
                     isPlaying: true,
                   )

3. å°çˆ±éŸ³ç®±å¼€å§‹æ’­æ”¾
   â””â”€> å°ç±³IoTäº‘ç«¯æ¨é€æŒ‡ä»¤åˆ°éŸ³ç®±
       â””â”€> éŸ³ç®±è®¿é—® musicUrl å¹¶æ’­æ”¾
```

### åœºæ™¯3: ç”¨æˆ·åˆ‡æ¢æ¨¡å¼

```
1. ç”¨æˆ·åœ¨è®¾ç½®ä¸­åˆ‡æ¢æ¨¡å¼
   â””â”€> playbackModeProvider.notifier.setMode(PlaybackMode.xiaomusic)
       â”œâ”€> state = PlaybackMode.xiaomusic
       â”œâ”€> ä¿å­˜åˆ° SharedPreferences
       â””â”€> è§¦å‘ Provider åˆ·æ–°

2. PlaybackProvider ç›‘å¬æ¨¡å¼å˜åŒ–
   â””â”€> _initializeStrategy() é‡æ–°åˆå§‹åŒ–
       â”œâ”€> é‡Šæ”¾æ—§ç­–ç•¥ _currentStrategy?.dispose()
       â””â”€> åˆ›å»ºæ–°ç­–ç•¥ RemotePlaybackStrategy(...)

3. è·³è½¬åˆ°å¯¹åº”ç™»å½•é¡µ
   â””â”€> Navigator.push('/login')
```

---

## ğŸ¤” æŠ€æœ¯å†³ç­–

### å†³ç­–1: ä¸ºä»€ä¹ˆé€‰æ‹©ç­–ç•¥æ¨¡å¼ï¼Ÿ

**èƒŒæ™¯**: éœ€è¦æ”¯æŒä¸¤ç§ä¸åŒçš„æ’­æ”¾æ§åˆ¶æ–¹å¼

**è€ƒè™‘çš„æ–¹æ¡ˆ**:
1. âŒ if-else åˆ¤æ–­æ¨¡å¼
2. âŒ ç»§æ‰¿ + å¤šæ€
3. âœ… **ç­–ç•¥æ¨¡å¼**

**é€‰æ‹©ç­–ç•¥æ¨¡å¼çš„åŸå› **:
- âœ… ç¬¦åˆå¼€é—­åŸåˆ™ï¼Œæ˜“äºæ‰©å±•æ–°æ¨¡å¼
- âœ… ç­–ç•¥ä¹‹é—´ç›¸äº’ç‹¬ç«‹ï¼ŒèŒè´£æ¸…æ™°
- âœ… ä¸ç°æœ‰ `PlaybackStrategy` æ¥å£å®Œç¾å¥‘åˆ
- âœ… æ˜“äºæµ‹è¯•å’Œç»´æŠ¤

### å†³ç­–2: ä¸ºä»€ä¹ˆè¦ä¿å­˜å°ç±³è´¦å·å¯†ç ï¼Ÿ

**èƒŒæ™¯**: ç›´è¿æ¨¡å¼éœ€è¦ç™»å½•å°ç±³è´¦å·

**å®‰å…¨æ€§è€ƒè™‘**:
- âœ… ä½¿ç”¨ SharedPreferences åŠ å¯†å­˜å‚¨
- âœ… ç”¨æˆ·å¯é€‰æ‹©æ˜¯å¦ä¿å­˜ï¼ˆsaveCredentialså‚æ•°ï¼‰
- âœ… ä»…ç”¨äºæœ¬åœ°è‡ªåŠ¨ç™»å½•
- âœ… ä¸ä¼šä¸Šä¼ åˆ°ä»»ä½•æœåŠ¡å™¨

**ç”¨æˆ·ä½“éªŒè€ƒè™‘**:
- âœ… ä¸‹æ¬¡æ‰“å¼€APPè‡ªåŠ¨ç™»å½•
- âœ… å‡å°‘é‡å¤è¾“å…¥

**å»ºè®®**:
- åœ¨ç™»å½•é¡µé¢æ·»åŠ "è®°ä½å¯†ç "é€‰é¡¹
- æä¾›æ¸…é™¤å‡­è¯çš„åŠŸèƒ½

### å†³ç­–3: ä¸ºä»€ä¹ˆç›´è¿æ¨¡å¼åŠŸèƒ½æœ‰é™ï¼Ÿ

**æŠ€æœ¯é™åˆ¶**:
- å°ç±³IoT APIä¸æä¾›æ’­æ”¾çŠ¶æ€æŸ¥è¯¢
- å°ç±³IoT APIä¸æ”¯æŒè¿›åº¦æ§åˆ¶
- å°ç±³IoT APIæ²¡æœ‰æ’­æ”¾é˜Ÿåˆ—æ¦‚å¿µ

**è§£å†³æ–¹æ¡ˆ**:
- âœ… æ˜ç¡®å‘ŠçŸ¥ç”¨æˆ·åŠŸèƒ½é™åˆ¶
- âœ… åœ¨UIä¸Šç¦ç”¨ä¸æ”¯æŒçš„åŠŸèƒ½
- â° æœªæ¥ç‰ˆæœ¬å¯å®ç°å®¢æˆ·ç«¯æ’­æ”¾é˜Ÿåˆ—

### å†³ç­–4: ä¸ºä»€ä¹ˆä½¿ç”¨ Riverpod è€Œä¸æ˜¯ Providerï¼Ÿ

**åŸå› **:
- âœ… é¡¹ç›®å·²ä½¿ç”¨ Riverpod
- âœ… Riverpod ç±»å‹å®‰å…¨æ›´å¥½
- âœ… æ”¯æŒ StateNotifier æ¨¡å¼
- âœ… æ›´å¥½çš„ä¾èµ–æ³¨å…¥æ”¯æŒ

---

## ğŸ”® æ‰©å±•æ€§è®¾è®¡

### æœªæ¥å¯èƒ½çš„æ‰©å±•

#### 1. æ·»åŠ æ›´å¤šæ’­æ”¾æ¨¡å¼

```dart
// æ‰©å±•æšä¸¾
enum PlaybackMode {
  xiaomusic,
  miIoTDirect,
  bluetoothDirect,  // æ–°å¢ï¼šè“ç‰™ç›´è¿æ¨¡å¼
  dlnaCast,         // æ–°å¢ï¼šDLNAæŠ•å±æ¨¡å¼
}

// æ–°å¢ç­–ç•¥
class BluetoothPlaybackStrategy implements PlaybackStrategy {
  // é€šè¿‡è“ç‰™æ§åˆ¶æ’­æ”¾
}

class DLNAPlaybackStrategy implements PlaybackStrategy {
  // é€šè¿‡DLNAåè®®æŠ•å±
}
```

#### 2. å¤šè®¾å¤‡åŒæ­¥æ’­æ”¾

```dart
class MultiDevicePlaybackStrategy implements PlaybackStrategy {
  final List<PlaybackStrategy> _strategies;

  @override
  Future<void> play() async {
    // åŒæ—¶æ§åˆ¶å¤šä¸ªè®¾å¤‡
    await Future.wait(_strategies.map((s) => s.play()));
  }
}
```

#### 3. å®¢æˆ·ç«¯æ’­æ”¾é˜Ÿåˆ—

```dart
class PlaybackQueueManager {
  final List<OnlineMusicResult> _queue;
  int _currentIndex = 0;

  Future<void> playNext() async {
    if (_currentIndex < _queue.length - 1) {
      _currentIndex++;
      await playCurrentTrack();
    }
  }

  Future<void> playPrevious() async {
    if (_currentIndex > 0) {
      _currentIndex--;
      await playCurrentTrack();
    }
  }
}
```

#### 4. æ™ºèƒ½æ¨¡å¼åˆ‡æ¢

```dart
class AutoSwitchPlaybackStrategy implements PlaybackStrategy {
  PlaybackStrategy _currentStrategy;

  Future<void> autoSwitch() async {
    // æ ¹æ®ç½‘ç»œçŠ¶å†µã€è®¾å¤‡å¯ç”¨æ€§è‡ªåŠ¨åˆ‡æ¢
    if (await isXiaomusicAvailable()) {
      _currentStrategy = RemotePlaybackStrategy(...);
    } else {
      _currentStrategy = MiIoTDirectPlaybackStrategy(...);
    }
  }
}
```

---

## ğŸ“Š æ€§èƒ½è€ƒè™‘

### ç™»å½•æ€§èƒ½ä¼˜åŒ–

```dart
// 1. ç¼“å­˜ serviceToken
class MiIoTService {
  String? _cachedToken;
  DateTime? _tokenExpireTime;

  Future<bool> login() async {
    if (_cachedToken != null && !_isTokenExpired()) {
      return true; // ä½¿ç”¨ç¼“å­˜token
    }
    // é‡æ–°ç™»å½•...
  }
}

// 2. å¹¶è¡Œè¯·æ±‚
Future<void> loginAndGetDevices() async {
  await login();

  // ç™»å½•æˆåŠŸåï¼Œå¹¶è¡Œè¯·æ±‚å¤šä¸ªAPI
  final results = await Future.wait([
    getDevices(),
    getUserProfile(),
    getPreferences(),
  ]);
}
```

### ç½‘ç»œè¯·æ±‚ä¼˜åŒ–

```dart
// ä½¿ç”¨Dioçš„æ‹¦æˆªå™¨æ·»åŠ é‡è¯•æœºåˆ¶
dio.interceptors.add(
  RetryInterceptor(
    dio: dio,
    retries: 3,
    retryDelays: [
      Duration(seconds: 1),
      Duration(seconds: 2),
      Duration(seconds: 3),
    ],
  ),
);
```

---

## ğŸ”’ å®‰å…¨æ€§è€ƒè™‘

### 1. å‡­è¯å­˜å‚¨å®‰å…¨

```dart
// ä½¿ç”¨ flutter_secure_storage åŠ å¯†å­˜å‚¨
import 'package:flutter_secure_storage/flutter_secure_storage.dart';

final storage = FlutterSecureStorage();

Future<void> saveCredentials(String account, String password) async {
  await storage.write(key: 'mi_account', value: account);
  await storage.write(key: 'mi_password', value: password);
}
```

### 2. HTTPSé€šä¿¡

```dart
// ç¡®ä¿æ‰€æœ‰APIè°ƒç”¨ä½¿ç”¨HTTPS
const String MI_API_BASE = 'https://api.mina.mi.com';
const String MI_ACCOUNT_API = 'https://account.xiaomi.com';
```

### 3. æ•æ„Ÿä¿¡æ¯è„±æ•

```dart
// æ—¥å¿—ä¸­è„±æ•å¤„ç†
void logSensitiveInfo(String account, String password) {
  final maskedAccount = account.replaceRange(
    3,
    account.length - 2,
    '*' * (account.length - 5),
  );
  debugPrint('Account: $maskedAccount'); // 138****1234
  // å¯†ç å®Œå…¨ä¸æ‰“å°
}
```

---

## ğŸ“ æ€»ç»“

### è®¾è®¡äº®ç‚¹

1. âœ… **å®Œå…¨ç¬¦åˆç°æœ‰æ¶æ„**
   - ä½¿ç”¨ç°æœ‰çš„ `PlaybackStrategy` æ¥å£
   - é›†æˆåˆ°ç°æœ‰çš„ Riverpod ä½“ç³»
   - ä¿æŒä»£ç é£æ ¼ä¸€è‡´

2. âœ… **é«˜å¯ç»´æŠ¤æ€§**
   - èŒè´£æ¸…æ™°ï¼Œæ¨¡å—åŒ–
   - éµå¾ªSOLIDåŸåˆ™
   - è¯¦ç»†çš„æ³¨é‡Šå’Œæ–‡æ¡£

3. âœ… **è‰¯å¥½çš„æ‰©å±•æ€§**
   - æ˜“äºæ·»åŠ æ–°çš„æ’­æ”¾æ¨¡å¼
   - æ˜“äºæ‰©å±•åŠŸèƒ½
   - æ”¯æŒæœªæ¥çš„éœ€æ±‚å˜åŒ–

4. âœ… **ç”¨æˆ·ä½“éªŒä¼˜å…ˆ**
   - è‡ªåŠ¨ç™»å½•
   - é…ç½®æŒä¹…åŒ–
   - æ¸…æ™°çš„é”™è¯¯æç¤º

### æŠ€æœ¯æ ˆ

- **çŠ¶æ€ç®¡ç†**: Riverpod
- **HTTPå®¢æˆ·ç«¯**: Dio
- **è·¯ç”±**: GoRouter
- **æœ¬åœ°å­˜å‚¨**: SharedPreferences
- **éŸ³é¢‘æ§åˆ¶**: audio_service
- **åŠ å¯†**: crypto (MD5)

---

**æ–‡æ¡£ç»´æŠ¤è€…**: å“ˆé›·é…± (ï¿£â–½ï¿£)ï¼
**æœ€åæ›´æ–°**: 2025-11-20
**çŠ¶æ€**: âœ… å®Œæˆ
