# HMusic - 智能音乐播放器 🎵

> 一款支持本地播放和远程控制的音乐播放器
>
> **双模式支持**：xiaomusic 服务端模式 + 小米 IoT 直连模式

[![Release](https://img.shields.io/github/v/release/hpcll/XiaoMi_Music_Client?label=版本)](https://github.com/hpcll/XiaoMi_Music_Client/releases)

## 🎯 双模式支持

HMusic 现在支持两种播放模式，满足不同用户的需求：

### 🖥️ xiaomusic 模式（服务端模式）

**适合人群**：拥有 NAS 或服务器的高级用户

**特点**：
- ✅ 功能完整（本地音乐库、播放列表、语音控制）
- ✅ 支持音乐下载和管理
- ✅ 支持播放进度、音量控制
- ✅ 支持上一曲/下一曲
- ⚠️ 需要部署 xiaomusic 服务端

### 📱 直连模式（无服务器模式）

**适合人群**：普通手机用户，无需服务器

**特点**：
- ✅ 无需服务器，开箱即用
- ✅ 只需小米账号即可使用
- ✅ 配置简单，轻量便捷
- ✅ 支持在线音乐搜索和播放
- ⚠️ 不支持本地音乐库和播放列表
- ⚠️ 不支持进度显示和音量控制

**两种模式可以自由切换，配置自动保存！**

## ✨ 核心功能

### 🎵 本地播放模式
- 手机本地音乐播放，智能模式切换
- 本地音乐自动扫描和管理
- 播放状态完整保持和恢复
- 流畅的播放体验，无卡顿

### 🌐 远程控制模式
- 远程音乐播放控制
- 多设备管理和切换
- 实时状态同步
- 设备在线监控

### 📱 完整功能
- ✅ **播放控制** - 播放/暂停、上一曲/下一曲、播放模式切换
- ✅ **音乐封面** - 智能封面搜索，主色调自适应光圈
- ✅ **播放列表** - 创建、管理、播放自定义列表
- ✅ **音乐下载** - 多音质选择（无损/高品质/标准）
- ✅ **音乐搜索** - 快速搜索并播放
- ✅ **音乐库管理** - 浏览、搜索、删除音乐文件
- ✅ **播放通知** - Android/iOS 通知栏控制
- ✅ **应用内更新** - 自动检测和更新提醒

## 🎨 界面预览

### 四个主要页面
1. **播放** - 封面、进度、控制、音量
2. **搜索** - 实时搜索、快速播放
3. **播放列表** - 列表管理、批量操作
4. **音乐库** - 本地音乐浏览管理

## 🚀 快速开始

### 方式一：xiaomusic 模式（服务端模式）

#### 服务端要求

⚠️ **需要部署服务端**: HMusic 的 xiaomusic 模式需要配合 [xiaomusic](https://github.com/hanxi/xiaomusic) 服务端使用。

**部署服务端**：
1. 访问 [xiaomusic 项目](https://github.com/hanxi/xiaomusic)
2. 按照文档部署服务端（支持 Docker 部署）
3. 记录服务器地址、端口和认证信息

#### 下载安装

从 [Releases](https://github.com/hpcll/XiaoMi_Music_Client/releases) 下载最新版本：
- **Android**: HMusic-v2.2.0.apk
- **iOS**: 即将推出

#### 首次使用

1. 打开应用，选择 **"xiaomusic 模式"**
2. 输入服务器信息：
   - **服务器地址**: `你的服务器IP:端口`
   - **用户名**: API 认证用户名
   - **密码**: API 认证密码
3. 登录后自动保存配置

---

### 方式二：直连模式（无服务器模式）✨ 新增！

#### 无需服务端

✅ **开箱即用**: 直连模式无需部署任何服务端，只需小米账号即可！

**适用条件**：
- ✅ 拥有小米 AI 音箱（小爱同学）
- ✅ 有小米账号
- ✅ 音箱已绑定到小米账号

#### 下载安装

从 [Releases](https://github.com/hpcll/XiaoMi_Music_Client/releases) 下载最新版本：
- **Android**: HMusic-v2.2.0.apk
- **iOS**: 即将推出

#### 首次使用

1. 打开应用，选择 **"直连模式"**
2. 输入小米账号信息：
   - **小米账号**: 手机号或邮箱
   - **密码**: 小米账号密码
3. 登录后自动获取设备列表
4. 开始搜索和播放音乐！

#### 模式切换

两种模式可以随时切换：
- 进入 **"设置"** 页面
- 点击 **"切换播放模式"**
- 选择你想要的模式

---

### 功能使用

**本地播放**
- 应用自动扫描手机音乐
- 点击歌曲即可播放
- 支持播放列表管理

**远程控制**
- 选择远程设备
- 控制音乐播放
- 实时查看播放状态

## ❓ 常见问题

### xiaomusic 模式相关

#### 1. 播放后音箱无声音，但暂停时音箱有"收到"的提示音？

**原因**：服务端的 IP 和端口配置不正确

**解决方法**：
1. 进入 xiaomusic 服务端的设置页面
2. 检查并修改"公网 IP"和"端口"配置
3. 确保填写的是客户端可以访问到的地址
4. 保存后重启服务端

#### 2. 登录账号密码是什么？

**答案**：登录账号密码需要在 xiaomusic 服务端中设置

**设置方法**：
1. 访问 xiaomusic 服务端管理页面
2. 进入"设置"页面
3. 找到"HTTP 认证"相关配置
4. 设置用户名和密码
5. 在客户端使用相同的账号密码登录

#### 3. 无法连接服务器？

**检查项**：
- 确认服务器地址和端口正确
- 确保客户端和服务端网络连通
- 验证服务端正在运行
- 检查防火墙设置

---

### 直连模式相关 ✨

#### 4. 直连模式需要部署服务器吗？

**答案**：完全不需要！

直连模式是 HMusic 的新功能，无需任何服务器或 NAS：
- ✅ 只需要小米账号
- ✅ 只需要小米 AI 音箱
- ✅ 手机和音箱连接同一网络即可

#### 5. 直连模式安全吗？我的账号密码会被上传吗？

**答案**：完全安全！

- ✅ 账号密码仅存储在您的手机本地
- ✅ 使用 HTTPS 加密通信
- ✅ 仅与小米官方服务器通信
- ✅ 不会上传到任何第三方服务器
- ✅ 您可以随时退出登录清除凭证

#### 6. 直连模式为什么不支持播放进度和音量控制？

**答案**：这是小米 IoT Cloud API 的限制

小米官方 API 不提供以下功能：
- ❌ 播放状态查询（无法获取实时进度）
- ❌ 进度拖动控制
- ❌ 音量调节
- ❌ 上一曲/下一曲

但基本的播放功能完全正常：
- ✅ 搜索音乐
- ✅ 播放音乐
- ✅ 暂停/继续

**提示**：如果需要完整功能，请使用 xiaomusic 模式！

#### 7. 直连模式找不到设备怎么办？

**检查项**：
- 确认小米账号正确
- 确认音箱已绑定到该账号
- 在米家 APP 中检查音箱是否在线
- 尝试退出登录后重新登录

#### 8. 可以同时使用两种模式吗？

**答案**：可以随时切换！

- 您可以在设置中切换模式
- 每种模式的配置独立保存
- 切换后自动加载对应配置
- 建议根据使用场景选择：
  - **在家/有服务器** → xiaomusic 模式（功能完整）
  - **外出/无服务器** → 直连模式（轻量便捷）

---

### 通用问题

#### 9. 本地播放无声音？

**检查项**：
- 检查手机音量设置
- 确认已授予存储权限
- 尝试重启应用

## 📚 开发者文档

如果你是开发者，想要了解或参与 HMusic 的开发，请查看：

- **[TODO.md](TODO.md)** - 开发任务清单和集成步骤
- **[ARCHITECTURE.md](ARCHITECTURE.md)** - 架构设计文档
- **[INTEGRATION_GUIDE.md](INTEGRATION_GUIDE.md)** - 集成指南
- **[DEVLOG.md](DEVLOG.md)** - 开发日志

## 📝 更新日志

查看 [CHANGELOG.md](CHANGELOG.md) 了解版本更新详情。

---

## ☕ 请作者喝杯咖啡

如果 HMusic 对你有帮助，欢迎请作者喝杯咖啡～ 你的支持是我持续开发的动力！

<p align="center">
  <img src="docs/donate/wechat.jpg" alt="微信赞赏码" width="300" />
  &nbsp;&nbsp;&nbsp;&nbsp;
  <img src="docs/donate/alipay.jpg" alt="支付宝收款码" width="300" />
</p>

<p align="center">
  <b>微信赞赏</b>
  &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
  <b>支付宝</b>
</p>

---

## 📜 许可证

本项目采用 **GNU Affero General Public License v3.0 (AGPL-3.0)** 许可证开源。

### 开源许可

- ✅ 个人学习、研究、非商业使用
- ✅ 修改代码（必须以相同许可证开源）
- ✅ 分发代码（必须以相同许可证开源）
- ✅ 网络服务使用（必须公开源代码）

### ⚠️ 商业使用限制

**商业使用需要获得授权！**

如果您希望将 HMusic 用于商业目的（包括但不限于）：
- 在商业产品中使用
- 提供付费服务
- 企业内部商业用途

请联系作者获取商业授权：
- 📧 Email: [在 GitHub Issues 中联系]
- 💬 GitHub: [https://github.com/hpcll/HMusic/issues](https://github.com/hpcll/HMusic/issues)

### 许可证全文

查看 [LICENSE](LICENSE) 文件了解完整的许可证条款。

---

**HMusic** - 让音乐更简单 🎶
